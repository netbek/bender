/*
 * bender
 * 
 * @author Hein Bekker <hein@netbek.co.za>
 * @copyright (c) 2016 Hein Bekker
 * @license http://www.gnu.org/licenses/agpl-3.0.txt AGPLv3
 */
!function(a,b){function c(){this.flags={init:!1},this.config={},this.ratios=[];for(var a,b=[[10,16],[10,15],[9,16],[3,4]],c=0,d=b.length;d>c;c++)a=b[c],this.ratios.push({width:a[0],height:a[1],ratio:a[0]/a[1],name:a[0]+":"+a[1]}),a[0]!==a[1]&&this.ratios.push({width:a[1],height:a[0],ratio:a[1]/a[0],name:a[1]+":"+a[0]})}a.bender||(c.prototype.getRatioName=function(a,c){for(var d,e=Number(a)/Number(c),f=0,g=this.ratios.length;g>f;f++)if(d=this.ratios[f],d.ratio===e)return d.name;return b},c.prototype.init=function(a){if(!this.flags.init){var c=this;this.flags.init=!0,this.config=jQuery.extend({},{sitemap:b,sitemapUrl:b,sitemapBaseUrl:b,baseUrl:"",screens:[]},a);for(var d,e,f,g=jQuery("#frames > ul"),h="",i=0,j=this.config.screens.length;j>i;i++)d=this.config.screens[i],e=d.split("-"),f=c.getRatioName(e[0],e[1]),h+="<li><p>"+e[0]+" x "+e[1]+(f?", "+f:"")+'</p><iframe class="f f-'+e[0]+"-"+e[1]+'"></iframe></li>';if(g.append(h),this.config.sitemap!==b)this.loadFrames();else{if(this.config.sitemapUrl===b)throw new Error("Either `sitemap` or `sitemapUrl` should be defined in config.");jQuery.ajax({cache:!1,method:"GET",dataType:"xml",url:this.config.sitemapUrl,error:function(){throw new Error("Could not load sitemap.")},success:function(a,b,d){c.config.sitemap={},jQuery(a).find("url").each(function(){var a=jQuery(this).find("loc").text();if(a.substr(0,c.config.sitemapBaseUrl.length)===c.config.sitemapBaseUrl){var b=a=a.substr(c.config.sitemapBaseUrl.length);""===b&&(b="/"),a=c.config.baseUrl+a,c.config.sitemap[a]=b}}),c.loadFrames()}})}}},c.prototype.loadFrames=function(){if(this.flags.init){var a,c,d,e=this,f=jQuery("iframe"),g=jQuery("#menu"),h=jQuery("<ul />"),i=[];for(a in this.config.sitemap)this.config.sitemap.hasOwnProperty(a)&&i.push(a);for(i.sort(),d=i.length,c=0;d>c;c++){a=i[c],this.config.firstUrl===b&&(this.config.firstUrl=a);var j=jQuery('<a href="'+a+'">'+this.config.sitemap[a]+"</a>").on("click",function(){var a=e.setCacheQueryParam(jQuery(this).attr("href"),e.config.cache);return f.attr("src",a),!1}),k=jQuery("<li />");k.append(j),h.append(k)}jQuery('a[href="#"]',g).on("click",function(){return!1}),d&&(jQuery("li.sitemap",g).append(h),f.attr("src",this.setCacheQueryParam(this.config.firstUrl,this.config.cache))),g.removeClass("hidden").superfish({delay:100,speed:100})}},c.prototype.setCacheQueryParam=function(a,b){var c;if(!1!==b)return a;c=Date.now();var d=new Url(a);return d.query.ts=c,d.toString()},a.bender=new c)}(this),function(a,b){var c=setInterval(function(){a.bender&&a.benderConfig&&a.jQuery&&a.Url&&(clearInterval(c),c=null,a.bender.init(a.benderConfig))})}(this);